<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon panier - DEANNA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        :root {
            --color-primary: #0B1C2A;
            --color-accent: #CFAF70;
            --color-bg-light: #FAF9F6;
            --color-text: #2C2C2C;
            --color-text-secondary: #6C6C6C;
            --color-border: #1A3B57;
            --color-error: #800020;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 2.5rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 1rem;
        }

        .cart-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        .item-details {
            flex-grow: 1;
        }

        .item-details h3 {
            font-size: 1.2rem;
            margin: 0 0 0.5rem;
            color: var(--color-primary);
        }

        .item-details p {
            margin: 0;
            color: var(--color-text-secondary);
        }
        
        .variations-list {
            margin: 0.5rem 0;
        }
        
        .variation-tag {
            display: inline-block;
            background-color: var(--color-accent);
            color: var(--color-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
        }
        
        .item-price {
            font-weight: 600;
            color: var(--color-accent);
            white-space: nowrap;
        }
        
        .item-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }
        
        .remove-btn {
            background-color: var(--color-error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .remove-btn:hover {
            background-color: #a00030;
        }
        
        .cart-summary {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--color-primary);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 2rem;
        }

        .cart-total {
            font-size: 1.5rem;
            color: var(--color-primary);
        }
        
        .checkout-btn {
            padding: 0.75rem 2rem;
            font-weight: 600;
            background-color: var(--color-accent);
            color: var(--color-primary);
            text-decoration: none;
            border-radius: 0.75rem;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            cursor: pointer;
        }
        
        .checkout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .empty-cart {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--color-text-secondary);
            font-style: italic;
        }
        
        .continue-shopping {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 2rem;
            background-color: var(--color-primary);
            color: white;
            text-decoration: none;
            border-radius: 0.75rem;
            transition: background-color 0.2s;
        }
        
        .continue-shopping:hover {
            background-color: #1a3b57;
        }
        
        .quantity-form {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .quantity-input {
            width: 60px;
            padding: 0.25rem;
            border: 1px solid #ddd;
            border-radius: 0.25rem;
            text-align: center;
        }
        
        .update-btn {
            padding: 0.25rem 0.5rem;
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Barre de navigation -->
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-color-primary">
                <a href="{% url 'index' %}" class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-color-accent" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 6.94C3 5.42 4.09 4.19 5.58 4.04L19.58 2.04C20.47 1.91 21.32 2.51 21.45 3.4L21.99 7.03C22.28 8.92 20.89 10.58 19 10.92L6.34 13.06C5.06 13.28 4.01 12.27 4.01 10.98V6.94H3ZM20.94 14.58L10.94 16.27C9.37 16.54 8.01 18 8.01 19.66V20.73C8.01 21.43 8.57 22.02 9.28 22.02H18.72C19.43 22.02 19.99 21.43 19.99 20.73V15.77C19.99 15.19 20.48 14.71 21.05 14.82C21.6 14.93 22 15.42 22 15.98V20.73C22 22.58 20.57 24 18.72 24H9.28C7.43 24 6 22.58 6 20.73V19.66C6 17.15 7.82 15.02 10.29 14.61L20.29 12.92C21.57 12.7 22.62 13.71 22.62 15V19.14L21.45 14.58H20.94Z" fill="currentColor"/>
                    </svg>
                    <span>DEANNA</span>
                </a>
            </h1>
            <nav class="flex space-x-4 items-center">
                <a href="{% url 'index' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Accueil</a>
                <a href="{% url 'product_list' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Produits</a>
                {% if user.is_authenticated %}
                    {% if is_merchant %}
                    <a href="{% url 'dashboard' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Tableau de bord</a>
                    {% elif is_client %}
                    <a href="{% url 'client_dashboard' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Mon compte</a>
                    {% endif %}
                    <a href="{% url 'logout_view' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Déconnexion</a>
                {% else %}
                    <a href="{% url 'create_shop' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Créer une boutique</a>
                    <a href="{% url 'create_client' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Créer un compte</a>
                    <a href="{% url 'login_view' %}" class="text-color-text-secondary hover:text-color-primary transition-colors">Connexion</a>
                {% endif %}
                <a href="{% url 'cart_detail' %}" class="text-color-primary font-semibold relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.76.707 1.76H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    {% if user.is_authenticated and cart.items.count > 0 %}
                    <span class="absolute -top-2 -right-2 bg-color-accent text-color-primary text-xs rounded-full h-5 w-5 flex items-center justify-center">
                        {{ cart.items.count }}
                    </span>
                    {% endif %}
                </a>
            </nav>
        </div>
    </header>

    <div class="container">
        <h1>Mon panier</h1>
        
        {% if cart and cart.items.all %}
            <ul class="cart-items">
                {% for item in cart.items.all %}
                    <li class="cart-item">
                        {% if item.product.images.first %}
                            <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.name }}" class="item-image">
                        {% else %}
                            <img src="https://via.placeholder.com/80x80.png?text=Pas+d'image" alt="Pas d'image" class="item-image">
                        {% endif %}
                        <div class="item-details">
                            <h3>{{ item.product.name }}</h3>
                            <p>Prix unitaire : {{ item.product.price }} CFA</p>
                            <p>Boutique : {{ item.product.shop.merchant.first_name }} {{ item.product.shop.merchant.last_name }}</p>
                            
                            <!-- NOUVEAU : Affichage des variations -->
                            {% if item.selected_variations.exists %}
                            <div class="variations-list">
                                <strong>Variations :</strong>
                                {% for variation in item.selected_variations.all %}
                                <span class="variation-tag">
                                    {{ variation.type }}: {{ variation.value }}
                                    {% if variation.price_modifier != 0 %}
                                    ({% if variation.price_modifier > 0 %}+{% endif %}{{ variation.price_modifier }} CFA)
                                    {% endif %}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}
                            
                            <form action="{% url 'update_cart_item' item.id %}" method="post" class="quantity-form">
                                {% csrf_token %}
                                <label for="quantity-{{ item.id }}">Quantité :</label>
                                <input type="number" id="quantity-{{ item.id }}" name="quantity" value="{{ item.quantity }}" min="1" class="quantity-input">
                                <button type="submit" class="update-btn">Mettre à jour</button>
                            </form>
                        </div>
                        <div class="item-actions">
                            <span class="item-price">{{ item.get_total }} CFA</span>
                            <form action="{% url 'remove_from_cart' item.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="remove-btn" onclick="return confirm('Supprimer cet article du panier ?')">X</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
            
            <div class="cart-summary">
                <span class="cart-total">Total : {{ total }} CFA</span>
                <a href="{% url 'checkout_view' %}" class="checkout-btn">Passer la commande</a>
            </div>
            
        {% else %}
            <div class="empty-cart">
                <p>Votre panier est vide.</p>
                <a href="{% url 'product_list' %}" class="continue-shopping">Continuer vos achats</a>
            </div>
        {% endif %}
    </div>

    <!-- Pied de page -->
    <footer class="bg-color-primary text-color-bg-light py-10 mt-8">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" class="text-color-text-secondary hover:text-color-bg-light transition-colors">À propos</a>
                <a href="#" class="text-color-text-secondary hover:text-color-bg-light transition-colors">Contact</a>
                <a href="#" class="text-color-text-secondary hover:text-color-bg-light transition-colors">Politique de confidentialité</a>
            </div>
            <p class="text-gray-500 text-sm">&copy; 2024 DEANNA E-commerce. Tous droits réservés.</p>
        </div>
    </footer>
</body>
</html>